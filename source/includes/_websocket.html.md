
# Websocket

## Common Format


> **Request format**

Valid options of op can be:  login, subscribe, unsubscribe, placeorder, cancelorder etc.

```json
{"op": "<value>", "args": ["<value1>","<value2>"]}
{"op": "<value>, "data":{"<key1>":"<value1>",...,"<keyN>":"<valueN>"}}
```

 `args`: the value is the channel name, which can be one or more channels.


 `data`: the data is the JSON string of request object, which is for operations like placeorder.

> **Success response format**

```json
 
  {"event": "login", "success": true}
  {"event": "placeorder", "success": true}
  {"event": "<value>","channel":"<value>"}
  {"table":"channel","data":"[{"<value1>","<value2>"}]"}

```

```
In the spot/depth channel, the return formats for 
distinguishing between the first full amount and the 
subsequent incremental data are:

```

```json

{"table":"channel","action":"<value>","data":"[{"<value1>","<value2>"}]"}

```

> **Failure response format:**

```json

{"event":"error","message":"<errorMessage>","errorCode":"<errorCode>","success": false}

```

> **Notification Response format:**

```json
> *`{"event":"OrderOpened", "success": true, "data":{...}}`



{"data":{"accountId":1,"action":"NEW","buyStop_limitedPrice":0,"buyStopTriggerPrice":0,"clientOrderId":10,"displayQuantity":0,"lastMatchPrice":0,"lastMatchQuantity":0,"lastMatchedOrderId":0,"lastMatchedOrderId2":0,"marketId":-1171569291644899584,"matchedId":0,"matchedType":"NONE","orderId":0,"price":1914480606655,"quantity":7800,"remainQuantity":0,"sellStop_limitedPrice":0,"sellStopTriggerPrice":0,"side":"BUY","status":"OPEN","timeCondition":"GTC"},"event":"OrderOpened","success":true}

```

##Login

> **Request format**

```json

{"op":"login","args":["<apiKey>","<timestamp>","<sign>"]or {"op":"login", "data":{"xCfToken":"<token generated by REST LOGIN API>"}}

```
* apiKey: the api key in subaccount information
* timestamp: UTC timestamp
* sign: TBD
* Each websocket must be login first. When using x-cf-token to login, the following rules apply: If the login is main account, then the main account id is used for trading activities. If the login is sub-account, then the default sub-account is used for trading activities. When using apiKey to login, the accountId bind to the apiKey is used for trading activites.

> **Success response format**

```json
 
{"event":"login","success":true}

```

> **Failure response format:**

```json
 
{"event":"login","success":false,"errorCode":"<errorCode>","message":"<errorMessage>"}

```
##Place Order
> **Request format**

```json
 
 {"op":"placeorder", data:{"clientOrderId":1, "marketCode": "BTC-USD-SWAP", "side":"BUY", "orderType":"LIMIT", "quantity":10, "timeInForce":"GTC", "limitPrice":7800}}

```
**Request Parameters Specification:**


Request Parameters In data | Type | Required | Engine Field | Description 
-------------------------- | -----|--------- | -------------|------------|
clientOrderId | Long | No | clientOrderId | You can customize order IDs to identify your orders. The system supports alphabets (case-sensitive) + numbers, or alphabets (case-sensitive) only, between 1-32 characters. 
marketCode | String | Yes | marketId (converted) | Market Code, e.g. BTC-USD-SWAP,BTC-USD-200626 
side | String | Yes | side |  Order direction: <ul><li>BUY  (Long) </li><li>SELL   (Short)</li></ul>     
orderType | String | Yes | orderType | Order types:     <ul><li>LIMIT </li><li>STOP</li></ul>     
quantity | DECIMAL | Yes | quantity | Quantity of the order. Minimum size is based on tradeIncrement
timeInForce | String | No (Default is: GTC) | timeCondition | Time in Force:<p></p>GTC (Default): Good till Cancelled <p></p>IOC: Immediate or Cancel (Taker only)<p></p>FOK: Fill or Kill (Cancel if full size not executable)<p></p>MAKERONLY: Post only<p></p>MAKERONLY_REPRICE: Post only, but if limit price isn't a maker price, adjust price to best maker price<p></p>
limitPrice| DECIMAL| No (with MARKET price later, this is not a requirement)|price |Limit order price. Used for LIMIT and STOP
triggerPrice | DECIMAL| No (only used for STOP type) |  buyStopTriggerPrice OR sell-stopTriggerPrice | Trigger (Stop) price 
triggerLimit | DECIMAL | No (only used for STOP type. Currently required as all STOP orders are STOP LIMIT orders) |buyStop_limitedPrice OR sell-stop_limitedPrice |Price of the limit order place after trigger is activated
action|String | INTERNAL USE|  | NEW| 
accountId | Long |INTERNAL USE |  | | 

> **Success response format**

```json
 
{"event": "placeorder", "success": true, "data": {'accountId' : <accountId>, 'orderId' : <orderId>', 'clientOrderId': <clientOrderId>, "timestamp":<timestamp>}}

```

Parameter | Type | Engine Field | Description| 
-------------------------- | -----|--------- | -------------|
event | String | | “placeorder” |
orderId |  Long | orderId |orderId used to identify the order |
clientOrderId | Long | clientOrderId | Customized ID if it was specified earlier.
errorCode | Integer | |   “0” if order is placed successfully<p></p>Others, see Error messages below
errorMessage | String |orderState |Error messages|
timestamp |Long | timestamp_epochMs | UNIX timestamp of when the order was opened

> **Failure response format:**

```json
 
{"event":"placeorder","message":"<errorMessage>","errorCode":"<errorCode>","success": false, "data": {'accountId' : <accountId>, 'clientOrderId': <clientOrderId>, "timestamp":<timestamp>}}

```

**Error Codes**

errorCode | errorMessage |  
-------------------------- | -----|
0 |“Success” |
1 |“Invalid market code”|
2 | NULL|
3 | NULL|
4 |“Insufficient funds”|
5 |“You have took many outstanding orders” |
6 | “You are sending orders too rapidly” |
7 | “You are not authenticated” |
8 | “Price/Quantity must not be zero”|
9 |“Post-only order with these parameters would result in an immediate match |

##Modify Order


> **Request format**

```json
 
{"op":"modifyorder", data:{"clientOrderId":1, "marketCode": "BTC-USD-SWAP", "side":"BUY", "orderType":"LIMIT", "quantity":10, "timeInForce":"GTC", "limitPrice":7800}}

```

**Request Parameters Specification:**

Request Parameters In data | Type | Required |Engine Field | Description| 
-------------------------- | -----|--------- | -------------|-----------|
orderId|Long| No (One of orderId or clientOrderId|orderId| |
clientOrderId|Long |No (One of orderId or clientOrderId) |clientOrderId|You can customize order IDs to identify your orders. The system supports alphabets (case-sensitive) + numbers, or alphabets (case-sensitive) only, between 1-32 characters.|
side|String| Yes| side| Order direction:<ul><li>BUY  (Long) </li><li>SELL   (Short)</li></ul>     
quantity|DECIMAL|Yes|quantity|Quantity of the order. Minimum size is based on tradeIncrement|
limitPrice|DECIMAL|Yes (with MARKET price later, this is not a requirement|price| Limit order price. Used for LIMIT and STOP|
action|String| INTERNAL USE| |  NEW|
accountId|Long|INTERNAL USE| | |

> **Success response format**

```json
 
{"event": "placeorder", "success": true}

```
>Note: this only indicates the order is requested to place.

> **Failure response format:**

```json

{"event":"placeorder","message":"<errorMessage>","errorCode":"<errorCode>","success": false, "data": {'accountId' : <accountId>, 'clientOrderId': <clientOrderId>, "timestamp":<timestamp>}}

```

##Cancel order##

> **Request format**

```json
 
 {“op”:”cancelorder”, data:{“clientOrderId”:”<clientOrderId>”, “marketCode“:”<marketCode>”, “orderId”:”<orderId>”}}

```


**Request Parameters Specification:**

Request Parameters In data | Type | Required | Description| 
-------------------------- | -----|--------- | -------------|
marketCode|String|Yes|Market Code, e.g. BTC-USD-SWAP,BTC-USD-200626|
clientOrderId|Long|No|Either clientOrderId or orderId must be present|
orderId|Long|No|Either clientOrderId or orderId must be present|
action|String|INTERNAL USE|CANCEL|
accountId|Long|INTERNAL USE| |

> **Success response format**

```json
 
{"data":{"accountId":30811,"clientOrderId":4,"lastTradeId":0,"marketCode":"BTC-USD-200626-LIN","orderId":1590754918000000025,"price":0E-9,"remainingQuantity":10.000000000,"side":"BUY","status":"CANCELED_BY_USER","taker":false,"tradeId":0},"event":"OrderMatched","success":true}

```
> **Failure response format:**

```json

{"event": "cancelorder", "message":"<errorMessage>","errorCode":"<errorCode>","success": false, "data": {'accountId' : <accountId>, 'clientOrderId': <clientOrderId>, “orderId”:”<orderId>”}}

```

##Notifications##

* Orderstatus

Response fields in data | Type | Description| 
-------------------------- | -----| -------------|
action| INTERNAL USE|Default Value: NEW|
clientOrderId|String|Echo of clientOrderId from request data|
errorCode|String|The error code indicates the error details|
message|String| The validation message|
notice|String|“OrderStatus”|
orderId|String|orderId generated by Trading Engine|
status|INTERNAL USE|Fixed Value: OPEN|
success|Boolean|true if success, false otherwise.|

* OrderOpened

Response fields in data | Type | Description| 
-------------------------- | -----| -------------|
event| String|  “OrderOpened”|
clientOrderId|String|Echo of clientOrderId from request data|
orderId|String|orderId generated by Trading Engine|
message|String| The validation message|
action| INTERNAL USE|Default Value: NEW|
status|INTERNAL USE|Fixed Value: OPEN|
errorCode|String| The error code indicates the error details|
success|Boolean|true if success, false otherwise.|

> **Success response format**

```json
 
{"data":{"accountId":1,"clientOrderId":10,"orderId":0},"event":"OrderOpened","success":true}

```



* OrderMatched
    * Response when an order has matched.



> **Success response format**

```json
 
{"data":{"accountId":1, 'action': 'NEW', 'marketCode':'BTC-USD-SWAP-LIN', 'buyStopLimitedPrice': 0, 'buyStopTriggerPrice': 0, 'clientOrderId': 16, 'displayQuantity': 0, 'lastMatchPrice': 1, 'lastMatchQuantity': 1, 'lastMatchedOrderId': 1590129346000000080, 'lastMatchedOrderId2': 1590129346000000082, 'matchedId': 1590129346000000086, 'matchedType': 'TAKER', 'orderId': 1590129346000000085, 'price': 60, 'quantity': 1, 'remainQuantity': 0, 'sellStop_limitedPrice': 0, 'sellStopTriggerPrice': 0, 'side': 'BUY', 'status': 'FILLED', 'timeCondition': 'GTC'},"event":"OrderMatched","success":true}

{"data":{"accountId":1, 'action': 'NEW', 'marketCode':'BTC-USD-SWAP-LIN', 'buyStopLimitedPrice': 0, 'buyStopTriggerPrice': 0, 'clientOrderId': 16, 'displayQuantity': 9, 'lastMatchPrice': 30, 'lastMatchQuantity': 1, 'lastMatchedOrderId': 1590129346000000085, 'lastMatchedOrderId2': 1590129346000000080, 'matchedId': 1590129346000000086, 'matchedType': 'MAKER', 'orderId': 1590129346000000082, 'price': 30, 'quantity': 10, 'remainQuantity': 9, 'sellStop_limitedPrice': 0, 'sellStopTriggerPrice': 0, 'side': 'SELL', 'status': 'PARTIALFILL', 'timeCondition': 'GTC'},"event":"OrderMatched","success":true}


```

Response fields in data | Type | Description| 
-------------------------- | -----| -------------|
accountId|  INTERNAL USE| |
action| INTERNAL USE|Default Value: NEW|
clientOrderId|Long|Echo of clientOrderId from request data|
event|String| “OrderMatched”|
fee| DECIMAL|Fee charged. Negative denotes rebate|
feeInstrumentId|String|Fee currency|
leg1Price|DECIMAL (optional) | Price of first leg (for spread and repo trades)|
leg2Price| DECIMAL (optional)| Price of the second leg (for spread and repo trades)|
marketCode|String｜Market Code, e.g. BTC-USD-SWAP,BTC-USD-200626|
orderId|Long|orderId generated by Trading Engine|
price| DECIMAL|Traded price|
quantity|DECIMAL|Quantity of the order. Minimum size is based on tradeIncrement|
remainingQuantity|DECIMAL|Remaining quantity|
side|String|Order direction: (BUY/SELL)|
taker|Boolean|TRUE: Order was taker side|
timestamp|Long|Timestamp when the trade was matched on the exchange.|
tradeId|  Long|Trade ID (match)|

* OrderClosed

> **Success response format**

```json
 
{"data":{"accountId":1, ...},"event":"OrderClosed","success":true}

```

Response fields in data | Type | Description| 
-------------------------- | -----| -------------|
clientOrderId| Long| |
orderId| Long||
action|INTERNAL USE||
status|INTERNAL USE| Fixed value: CLOSED|
accountId|  INTERNAL USE||

##Channels##
* channel list

**Channels that don't require login**

futures/depth 

* Public - Depth

> **Request**

```json
 
{"op": "subscribe", "args":["futures/depth:BTC-USD-190628"]}

```

>change to

```json
 
{"op": "subscribe", "args":["depth:BTC-USD-190628"]}

```

> **Response**

```json
 
{
    "table": "futures/depth",
    "data": [{
        "asks": [
            ["5556.82", "11", "0", "1"],
            ["5556.84", "98", "0", "4"],
            ["5556.92", "1", "0", "1"],
            ["5557.6", "4", "0", "1"],
            ["5557.85", "2", "0", "1"]
        ],
        "bids": [
            ["5556.81", "1", "0", "1"],
            ["5556.8", "2", "0", "1"],
            ["5556.79", "1", "0", "1"],
            ["5556.19", "100", "0", "1"],
            ["5556.08", "2", "0", "1"]
        ],
        "instrumentId": "BTC-USD-190628",
        "timestamp": "2019-05-06T07:19:39.348Z"
    }]
}

```

```json
 
{
    "table": "depth",
    "data": [{
        "asks": [
            ["5556.82", "11", "0", "1"],
            ["5556.84", "98", "0", "4"],
            ["5556.92", "1", "0", "1"],
            ["5557.6", "4", "0", "1"],
            ["5557.85", "2", "0", "1"]
        ],
        "bids": [
            ["5556.81", "1", "0", "1"],
            ["5556.8", "2", "0", "1"],
            ["5556.79", "1", "0", "1"],
            ["5556.19", "100", "0", "1"],
            ["5556.08", "2", "0", "1"]
        ],
        "instrumentId": "BTC-USD-190628",
        "timestamp": "2019-05-06T07:19:39.348Z"
    }]
}

```


**Description**

futures/depth is channel name ，BTC-USD-190628 is instrumentId

bids and asks value example:

["411.8", "10", "1", "4"] 411.8 is the price; 10 is the contract size at the price; 1 is the number of the liquidated orders at the price; 4 is the number of orders at the price.

Parameters | Parameters Types | Description| 
-------------------------- | -----| -------------|
bids| List<String>|Buy side depth |
instrumentId| String|Contract ID，e.g .BTC-USD-170310 ,BTC-USDT-191227|
asks|List<String>|Sell side depth|
timestamp|String|   System time stamp|


* Place Order


> **Request Format**

```json

{"op": "subscribe", "args":["ticker:BTC-USD-SWAP-LIN"]}

```
**Request Parameters Specification:**

Response fields in data | Type | Required| Engine Field|Description| 
-------------------------- | -----| -------------|-------|---------|
clientOrderId| Long| No|clientOrderId|You can customize order IDs to identify your orders. The system supports alphabets (case-sensitive) + numbers, or alphabets (case-sensitive) only, between 1-32 characters.
marketCode|String|Yes|marketId (converted)|Market Code, e.g. BTC-USD-SWAP,BTC-USD-200626
side| String|Yes|side|Order direction: <ul><li>BUY  (Long) </li><li>SELL   (Short)</li></ul>     
orderType|String|Yes|orderType| Order types:<ul><li>LIMIT </li><li>STOP</li></ul>     
quantity|DECIMAL|Yes|quantity|Quantity of the order. Minimum|
